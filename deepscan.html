<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencari Posisi Akurat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .description {
            margin-bottom: 25px;
            line-height: 1.5;
            opacity: 0.9;
        }
        
        .status {
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .results {
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin: 12px 0;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .value {
            font-weight: 600;
            color: #a8e6cf;
        }
        
        button {
            background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
            width: 100%;
        }
        
        button:hover {
            background: linear-gradient(135deg, #0083b0 0%, #00b4db 100%);
            transform: translateY(-2px);
        }
        
        .progress {
            height: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
            border-radius: 4px;
            width: 0%;
            transition: width 0.4s ease;
        }
        
        .note {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìç Pencari Posisi Akurat</h1>
        <p class="description">Program ini akan mengambil 5 sample lokasi dan memilih yang paling akurat.</p>
        
        <div class="status">
            <p>Status: <span id="statusText">Menunggu untuk memulai...</span></p>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <p>Sample: <span id="progressText">0/5</span></p>
        </div>
        
        <button id="startBtn">Dapatkan Posisi</button>
        
        <div class="results">
            <h2>Hasil Posisi</h2>
            <div class="result-item">
                <span>Latitude:</span>
                <span class="value" id="latitude">-</span>
            </div>
            <div class="result-item">
                <span>Longitude:</span>
                <span class="value" id="longitude">-</span>
            </div>
            <div class="result-item">
                <span>Akurasi:</span>
                <span class="value" id="accuracy">- meter</span>
            </div>
            <div class="result-item">
                <span>Sample Terbaik:</span>
                <span class="value" id="bestSample">-</span>
            </div>
        </div>
        
        <p class="note">Akurasi 5 meter dimungkinkan dengan GPS modern, tetapi tergantung pada perangkat dan kondisi lingkungan.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('startBtn');
            const statusText = document.getElementById('statusText');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const latitudeElem = document.getElementById('latitude');
            const longitudeElem = document.getElementById('longitude');
            const accuracyElem = document.getElementById('accuracy');
            const bestSampleElem = document.getElementById('bestSample');
            
            // Pengaturan
            const sampleCount = 5;
            const targetAccuracy = 5; // dalam meter (target yang diinginkan)
            const timeout = 30000; // 30 detik
            
            let samples = [];
            let currentSample = 0;
            let isRunning = false;
            
            startBtn.addEventListener('click', startGeolocation);
            
            function startGeolocation() {
                if (isRunning) return;
                
                startBtn.disabled = true;
                statusText.textContent = "Mencari sinyal GPS...";
                samples = [];
                currentSample = 0;
                updateProgress(0);
                isRunning = true;
                
                if (!navigator.geolocation) {
                    statusText.textContent = "Geolocation tidak didukung browser ini";
                    startBtn.disabled = false;
                    isRunning = false;
                    return;
                }
                
                // Mulai mengambil sample
                takeSample();
            }
            
            function takeSample() {
                if (currentSample >= sampleCount) {
                    // Semua sample telah diambil
                    finishSampling();
                    return;
                }
                
                statusText.textContent = `Mengambil sample ${currentSample+1}/${sampleCount}...`;
                
                navigator.geolocation.getCurrentPosition(
                    successCallback,
                    errorCallback,
                    {
                        enableHighAccuracy: true,
                        timeout: timeout,
                        maximumAge: 0
                    }
                );
            }
            
            function successCallback(position) {
                const accuracy = position.coords.accuracy;
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                
                samples.push({
                    accuracy: accuracy,
                    latitude: latitude,
                    longitude: longitude,
                    timestamp: position.timestamp
                });
                
                currentSample++;
                updateProgress(currentSample);
                
                // Lanjut ke sample berikutnya
                setTimeout(takeSample, 1000);
            }
            
            function errorCallback(error) {
                let errorMsg;
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMsg = "Pengguna menolak permintaan geolokasi.";
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMsg = "Informasi lokasi tidak tersedia.";
                        break;
                    case error.TIMEOUT:
                        errorMsg = "Permintaan lokasi sudah timeout.";
                        break;
                    default:
                        errorMsg = "Error tidak diketahui.";
                }
                
                statusText.textContent = "Error: " + errorMsg;
                startBtn.disabled = false;
                isRunning = false;
            }
            
            function finishSampling() {
                if (samples.length === 0) {
                    statusText.textContent = "Tidak ada sample yang berhasil diambil";
                    startBtn.disabled = false;
                    isRunning = false;
                    return;
                }
                
                // Cari sample dengan akurasi terbaik
                const bestSample = samples.reduce((best, current) => {
                    return (current.accuracy < best.accuracy) ? current : best;
                });
                
                // Tampilkan hasil
                latitudeElem.textContent = bestSample.latitude.toFixed(6);
                longitudeElem.textContent = bestSample.longitude.toFixed(6);
                accuracyElem.textContent = bestSample.accuracy.toFixed(2) + " meter";
                
                // Tentukan sample terbaik
                const bestIndex = samples.findIndex(s => s.accuracy === bestSample.accuracy) + 1;
                bestSampleElem.textContent = `Sample ${bestIndex}`;
                
                statusText.textContent = "Posisi berhasil ditemukan!";
                startBtn.disabled = false;
                isRunning = false;
                
                // Tampilkan pesan tentang akurasi
                if (bestSample.accuracy <= targetAccuracy) {
                    statusText.textContent += " Akurasi ‚â§5 meter tercapai!";
                } else {
                    statusText.textContent += ` Akurasi terbaik: ${bestSample.accuracy.toFixed(2)} meter.`;
                }
                
                // Data siap untuk disalin ke database
                console.log("Data posisi terbaik:", bestSample);
            }
            
            function updateProgress(progress) {
                const percentage = (progress / sampleCount) * 100;
                progressBar.style.width = percentage + '%';
                progressText.textContent = `${progress}/${sampleCount}`;
            }
        });
    </script>
</body>
</html>
